


	MSG_GMT DB 13,10,"GMT:",0
	MSG_IST DB 13,10,"IST:",0
	
	UPPER DB 0
	LOWER DB 0
	TEMP DB 0

	HOURS TIMES 10 DB 0
	MINUTES TIMES 10 DB 0
	SECONDS TIMES 10 DB 0
	
	DAYS DB 0
	
	
%MACRO TIME.BCD.NUM 1
		MOV [TEMP],%1
		CALL TIMEBCDNUM
%ENDMACRO

TIMEBCDNUM:
	MOV BL,10
	MOV BH,[TEMP]
	AND BH,11110000B
	SHR BH,4
	MOV AL,BH
	MUL BL
	MOV BH,[TEMP]
	AND BH,00001111B
	ADD AL,BH
	RET
	
	
%MACRO BCD.PRINT 1
	;HOUR
	MOV AL,0
	MOV [TEMP],%1
	AND %1,11110000B
	SHR %1,4
	MOV AL,%1
	ADD AL,48
	CALL PRINT_SC
	
	MOV AL,0
	MOV %1,[TEMP]
	AND %1,00001111B
	MOV AL,%1
	ADD AL,48
	CALL PRINT_SC
%ENDMACRO
	
	

%INCLUDE "C:/LIB/CNS.asm"		
	
PRINT_SC:

	MOV AH,0X0E
	INT 0X10
	RET
	
	
;-----------------------------------------------------------------------------
;GET TIME
;-----------------------------------------------------------------------------


GET_TIME:

	MOV AH,02H
	INT 1AH
	Console.print MSG_GMT
	
	MOV [HOURS],CH
	MOV [MINUTES],CL
	MOV [SECONDS],DH
	
	BCD.PRINT CH
	MOV AL,':'
	CALL PRINT_SC
	
	BCD.PRINT CL
	MOV AL,':'
	CALL PRINT_SC
	
	BCD.PRINT DH
	
	
	Console.print MSG_IST
	
	MOV CH,[HOURS]
	MOV CL,[MINUTES]
	MOV DH,[SECONDS]
	
	
	TIME.BCD.NUM CH
	MOV [HOURS],AL
	
	;ADD AL,40
	;CALL PRINT_SC
	
	TIME.BCD.NUM CL
	MOV [MINUTES],AL
		
	;CALL PRINT_SC	
		
CHECK_MINUTES:

	ADD AL,30
	CMP AL,60
	JGE CONVERT_MINUTES
	JNE SET_MINUTES
	
CONVERT_MINUTES:

	MOV [TEMP],AL
	SUB AL,60
	MOV [MINUTES],AL
	
	
	;ADD AL,31
	;CALL PRINT_SC
	
	MOV AL,[HOURS]
	ADD AL,1
	MOV [HOURS],AL
	JMP CHECK_HOURS
	
	
SET_MINUTES:
	MOV [MINUTES],AL
	
	;ADD AL,31
	;CALL PRINT_SC	
	
CHECK_HOURS:

	
	MOV AL,[HOURS]
	ADD AL,5
	CMP AL,24
	JGE CONVERT_HOURS
	JNE SET_HOURS
	
CONVERT_HOURS:
	
	MOV [TEMP],AL
	SUB AL,24
	MOV [HOURS],AL
	MOV AL,1
	MOV [DAYS],AL
	
	
SET_HOURS:
	MOV [HOURS],AL
	
	
	;ADD AL,31
	;CALL PRINT_SC
	
TIME_DONE:
	
	CONVERT.TO.STRING HOURS
	CONVERT.TO.STRING MINUTES
	Console.print HOURS
	MOV AL,':'
	CALL PRINT_SC
	Console.print MINUTES
	MOV AL,':'
	CALL PRINT_SC
	
	
	MOV DH,[SECONDS]
	BCD.PRINT DH
	
	
	RET
